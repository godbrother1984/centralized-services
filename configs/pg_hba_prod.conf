# PostgreSQL Production Host-Based Authentication
# File: centralized-services/pg_hba_prod.conf
# Version: 1.0.0
# Date: 2025-09-19
# Description: Production-hardened authentication configuration

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             postgres                                peer
local   all             all                                     scram-sha-256

# IPv4 local connections:
host    all             postgres        127.0.0.1/32            scram-sha-256
host    all             postgres        ::1/128                 scram-sha-256

# Internal Docker network connections - Restrict to specific subnets
host    all             all             172.20.0.0/16           scram-sha-256  # proxy-network-prod
host    all             all             172.22.0.0/16           scram-sha-256  # database-network-prod

# Application-specific database access
host    postgres        postgres        172.20.0.0/16           scram-sha-256
host    n8n_db          n8n_user        172.20.0.0/16           scram-sha-256
host    n8n_db          n8n_user        172.22.0.0/16           scram-sha-256

# Deny all other connections
host    all             all             0.0.0.0/0               reject
host    all             all             ::/0                    reject